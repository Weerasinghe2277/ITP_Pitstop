<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer NIC Management API Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .container {
      background-color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    h1,
    h2 {
      color: #333;
      border-bottom: 2px solid #007bff;
      padding-bottom: 10px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
      color: #555;
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
      box-sizing: border-box;
    }

    button {
      background-color: #007bff;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    button:hover {
      background-color: #0056b3;
    }

    .delete-btn {
      background-color: #dc3545;
    }

    .delete-btn:hover {
      background-color: #c82333;
    }

    .response {
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 5px;
      padding: 15px;
      margin-top: 20px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }

    .success {
      border-color: #28a745;
      background-color: #d4edda;
    }

    .error {
      border-color: #dc3545;
      background-color: #f8d7da;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üè¢ Customer NIC Management API Test</h1>
    <p><strong>Note:</strong> This interface is for testing API endpoints. You need to be logged in as a cashier, admin,
      or owner to use these features.</p>

    <!-- Authentication Section -->
    <div class="form-group">
      <label for="authToken">Authentication Token:</label>
      <input type="text" id="authToken" placeholder="Enter your JWT token here">
    </div>

    <div class="form-group">
      <label for="apiBase">API Base URL:</label>
      <input type="text" id="apiBase" value="http://localhost:5000/api/users" placeholder="API Base URL">
    </div>
  </div>

  <div class="grid">
    <!-- Store Customer NIC -->
    <div class="container">
      <h2>üîí Store Customer NIC</h2>

      <div class="form-group">
        <label for="storeNic">NIC Number:</label>
        <input type="text" id="storeNic" placeholder="e.g., 123456789V or 200012345678">
      </div>

      <div class="form-group">
        <label for="storeEmail">Email:</label>
        <input type="email" id="storeEmail" placeholder="customer@example.com">
      </div>

      <div class="form-group">
        <label for="storePassword">Password:</label>
        <input type="password" id="storePassword" placeholder="Password (min 8 chars)">
      </div>

      <div class="form-group">
        <label for="storeFirstName">First Name:</label>
        <input type="text" id="storeFirstName" placeholder="John">
      </div>

      <div class="form-group">
        <label for="storeLastName">Last Name:</label>
        <input type="text" id="storeLastName" placeholder="Doe">
      </div>

      <div class="form-group">
        <label for="storePhone">Phone Number:</label>
        <input type="text" id="storePhone" placeholder="0771234567">
      </div>

      <div class="form-group">
        <label for="storeDateOfBirth">Date of Birth:</label>
        <input type="date" id="storeDateOfBirth">
      </div>

      <div class="form-group">
        <label for="storeStreet">Street Address:</label>
        <input type="text" id="storeStreet" placeholder="123 Main Street">
      </div>

      <div class="form-group">
        <label for="storeCity">City:</label>
        <input type="text" id="storeCity" placeholder="Colombo">
      </div>

      <div class="form-group">
        <label for="storeProvince">Province:</label>
        <select id="storeProvince">
          <option value="">Select Province</option>
          <option value="Western">Western</option>
          <option value="Central">Central</option>
          <option value="Southern">Southern</option>
          <option value="Eastern">Eastern</option>
          <option value="Northern">Northern</option>
          <option value="North Central">North Central</option>
          <option value="North Western">North Western</option>
          <option value="Sabaragamuwa">Sabaragamuwa</option>
          <option value="Uva">Uva</option>
        </select>
      </div>

      <div class="form-group">
        <label for="storePostalCode">Postal Code:</label>
        <input type="text" id="storePostalCode" placeholder="10100">
      </div>

      <button onclick="storeCustomerNic()">Store Customer NIC</button>
      <div id="storeResponse" class="response"></div>
    </div>

    <!-- Get All Customer NICs -->
    <div class="container">
      <h2>üìã Get All Customer NICs</h2>

      <div class="form-group">
        <label for="searchTerm">Search Term (optional):</label>
        <input type="text" id="searchTerm" placeholder="Search by NIC, name, or email">
      </div>

      <div class="form-group">
        <label for="page">Page:</label>
        <input type="number" id="page" value="1" min="1">
      </div>

      <div class="form-group">
        <label for="limit">Limit:</label>
        <input type="number" id="limit" value="10" min="1" max="100">
      </div>

      <button onclick="getAllCustomerNics()">Get All Customer NICs</button>
      <div id="getAllResponse" class="response"></div>
    </div>

    <!-- Update Customer NIC -->
    <div class="container">
      <h2>‚úèÔ∏è Update Customer NIC</h2>

      <div class="form-group">
        <label for="updateNicParam">NIC to Update:</label>
        <input type="text" id="updateNicParam" placeholder="Current NIC number">
      </div>

      <div class="form-group">
        <label for="updateNicNew">New NIC (optional):</label>
        <input type="text" id="updateNicNew" placeholder="Leave empty to keep current">
      </div>

      <div class="form-group">
        <label for="updateFirstName">First Name:</label>
        <input type="text" id="updateFirstName" placeholder="Updated first name">
      </div>

      <div class="form-group">
        <label for="updateLastName">Last Name:</label>
        <input type="text" id="updateLastName" placeholder="Updated last name">
      </div>

      <div class="form-group">
        <label for="updatePhone">Phone:</label>
        <input type="text" id="updatePhone" placeholder="Updated phone number">
      </div>

      <div class="form-group">
        <label for="updateEmail">Email:</label>
        <input type="email" id="updateEmail" placeholder="Updated email">
      </div>

      <button onclick="updateCustomerNic()">Update Customer NIC</button>
      <div id="updateResponse" class="response"></div>
    </div>

    <!-- Delete Customer NIC -->
    <div class="container">
      <h2>üóëÔ∏è Delete Customer NIC</h2>

      <div class="form-group">
        <label for="deleteNic">NIC to Delete:</label>
        <input type="text" id="deleteNic" placeholder="NIC number to delete">
      </div>

      <button class="delete-btn" onclick="deleteCustomerNic()">Delete Customer NIC</button>
      <div id="deleteResponse" class="response"></div>
    </div>
  </div>

  <script>
    const apiBase = () => document.getElementById('apiBase').value;
    const getAuthHeaders = () => {
      const token = document.getElementById('authToken').value;
      return {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      };
    };

    async function storeCustomerNic() {
      const responseDiv = document.getElementById('storeResponse');

      try {
        const customerData = {
          nic: document.getElementById('storeNic').value,
          customerData: {
            email: document.getElementById('storeEmail').value,
            password: document.getElementById('storePassword').value,
            profile: {
              firstName: document.getElementById('storeFirstName').value,
              lastName: document.getElementById('storeLastName').value,
              phoneNumber: document.getElementById('storePhone').value,
              dateOfBirth: document.getElementById('storeDateOfBirth').value,
              address: {
                street: document.getElementById('storeStreet').value,
                city: document.getElementById('storeCity').value,
                province: document.getElementById('storeProvince').value,
                postalCode: document.getElementById('storePostalCode').value
              }
            },
            customerDetails: {
              emergencyContact: {
                name: "Emergency Contact",
                phoneNumber: "0771234567",
                relationship: "friend"
              }
            }
          }
        };

        const response = await fetch(`${apiBase()}/customers/nic`, {
          method: 'POST',
          headers: getAuthHeaders(),
          body: JSON.stringify(customerData)
        });

        const data = await response.json();
        responseDiv.textContent = JSON.stringify(data, null, 2);
        responseDiv.className = `response ${response.ok ? 'success' : 'error'}`;
      } catch (error) {
        responseDiv.textContent = `Error: ${error.message}`;
        responseDiv.className = 'response error';
      }
    }

    async function getAllCustomerNics() {
      const responseDiv = document.getElementById('getAllResponse');

      try {
        const searchParams = new URLSearchParams();

        const search = document.getElementById('searchTerm').value;
        const page = document.getElementById('page').value;
        const limit = document.getElementById('limit').value;

        if (search) searchParams.set('search', search);
        if (page) searchParams.set('page', page);
        if (limit) searchParams.set('limit', limit);

        const response = await fetch(`${apiBase()}/customers/nic?${searchParams}`, {
          method: 'GET',
          headers: getAuthHeaders()
        });

        const data = await response.json();
        responseDiv.textContent = JSON.stringify(data, null, 2);
        responseDiv.className = `response ${response.ok ? 'success' : 'error'}`;
      } catch (error) {
        responseDiv.textContent = `Error: ${error.message}`;
        responseDiv.className = 'response error';
      }
    }

    async function updateCustomerNic() {
      const responseDiv = document.getElementById('updateResponse');

      try {
        const nic = document.getElementById('updateNicParam').value;
        if (!nic) {
          throw new Error('NIC parameter is required');
        }

        const updateData = {};

        const newNic = document.getElementById('updateNicNew').value;
        const firstName = document.getElementById('updateFirstName').value;
        const lastName = document.getElementById('updateLastName').value;
        const phone = document.getElementById('updatePhone').value;
        const email = document.getElementById('updateEmail').value;

        if (newNic || firstName || lastName || phone) {
          updateData.profile = {};
          if (newNic) updateData.profile.nic = newNic;
          if (firstName) updateData.profile.firstName = firstName;
          if (lastName) updateData.profile.lastName = lastName;
          if (phone) updateData.profile.phoneNumber = phone;
        }

        if (email) {
          updateData.email = email;
        }

        const response = await fetch(`${apiBase()}/customers/nic/${encodeURIComponent(nic)}`, {
          method: 'PATCH',
          headers: getAuthHeaders(),
          body: JSON.stringify(updateData)
        });

        const data = await response.json();
        responseDiv.textContent = JSON.stringify(data, null, 2);
        responseDiv.className = `response ${response.ok ? 'success' : 'error'}`;
      } catch (error) {
        responseDiv.textContent = `Error: ${error.message}`;
        responseDiv.className = 'response error';
      }
    }

    async function deleteCustomerNic() {
      const responseDiv = document.getElementById('deleteResponse');

      try {
        const nic = document.getElementById('deleteNic').value;
        if (!nic) {
          throw new Error('NIC is required');
        }

        if (!confirm(`Are you sure you want to delete customer with NIC: ${nic}?`)) {
          return;
        }

        const response = await fetch(`${apiBase()}/customers/nic/${encodeURIComponent(nic)}`, {
          method: 'DELETE',
          headers: getAuthHeaders()
        });

        const data = await response.json();
        responseDiv.textContent = JSON.stringify(data, null, 2);
        responseDiv.className = `response ${response.ok ? 'success' : 'error'}`;
      } catch (error) {
        responseDiv.textContent = `Error: ${error.message}`;
        responseDiv.className = 'response error';
      }
    }
  </script>
</body>

</html>